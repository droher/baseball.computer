
WITH databank AS (
    SELECT
        pitch.season,
        pitch.team_id,
        people.retrosheet_player_id AS player_id,
        'RegularSeason' AS game_type,
        SUM(pitch.wins)::INT AS wins,
        SUM(pitch.losses)::INT AS losses,
        SUM(pitch.games)::INT AS games,
        SUM(pitch.games_started)::INT AS games_started,
        SUM(pitch.complete_games)::INT AS complete_games,
        SUM(pitch.shutouts)::INT AS shutouts,
        SUM(pitch.saves)::INT AS saves,
        SUM(pitch.outs_recorded)::INT AS outs_recorded,
        SUM(pitch.hits)::INT AS hits,
        SUM(pitch.earned_runs)::INT AS earned_runs,
        SUM(pitch.home_runs)::INT AS home_runs,
        SUM(pitch.walks)::INT AS walks,
        SUM(pitch.strikeouts)::INT AS strikeouts,
        SUM(pitch.intentional_walks)::INT AS intentional_walks,
        SUM(pitch.wild_pitches)::INT AS wild_pitches,
        SUM(pitch.hit_by_pitches)::INT AS hit_by_pitches,
        SUM(pitch.balks)::INT AS balks,
        SUM(pitch.batters_faced)::INT AS batters_faced,
        SUM(pitch.games_finished)::INT AS games_finished,
        SUM(pitch.runs)::INT AS runs,
        SUM(pitch.sacrifice_hits)::INT AS sacrifice_hits,
        SUM(pitch.sacrifice_flies)::INT AS sacrifice_flies,
        SUM(pitch.grounded_into_double_plays)::INT AS grounded_into_double_plays,
    FROM "timeball"."main_models"."stg_databank_pitching" AS pitch
    INNER JOIN "timeball"."main_models"."stg_people" AS people USING (databank_player_id)
    -- We'd need to do something different for partial coverage seasons but
    -- currently box scores are all or nothing for a given year
    WHERE pitch.season NOT IN (SELECT DISTINCT season FROM "timeball"."main_models"."stg_games")
    GROUP BY 1, 2, 3
),

retrosheet AS (
    SELECT
        games.season,
        stats.team_id,
        stats.player_id,
        games.game_type,
        COUNT(*)::INT AS games,
        SUM(batters_faced)::INT AS batters_faced,
        SUM(outs_recorded)::INT AS outs_recorded,
        SUM(inherited_runners_scored)::INT AS inherited_runners_scored,
        SUM(bequeathed_runners_scored)::INT AS bequeathed_runners_scored,
        SUM(team_unearned_runs)::INT AS team_unearned_runs,
        SUM(plate_appearances)::INT AS plate_appearances,
        SUM(at_bats)::INT AS at_bats,
        SUM(hits)::INT AS hits,
        SUM(singles)::INT AS singles,
        SUM(doubles)::INT AS doubles,
        SUM(triples)::INT AS triples,
        SUM(home_runs)::INT AS home_runs,
        SUM(total_bases)::INT AS total_bases,
        SUM(strikeouts)::INT AS strikeouts,
        SUM(walks)::INT AS walks,
        SUM(intentional_walks)::INT AS intentional_walks,
        SUM(hit_by_pitches)::INT AS hit_by_pitches,
        SUM(sacrifice_hits)::INT AS sacrifice_hits,
        SUM(sacrifice_flies)::INT AS sacrifice_flies,
        SUM(reached_on_errors)::INT AS reached_on_errors,
        SUM(reached_on_interferences)::INT AS reached_on_interferences,
        SUM(inside_the_park_home_runs)::INT AS inside_the_park_home_runs,
        SUM(ground_rule_doubles)::INT AS ground_rule_doubles,
        SUM(infield_hits)::INT AS infield_hits,
        SUM(on_base_opportunities)::INT AS on_base_opportunities,
        SUM(on_base_successes)::INT AS on_base_successes,
        SUM(grounded_into_double_plays)::INT AS grounded_into_double_plays,
        SUM(double_plays)::INT AS double_plays,
        SUM(triple_plays)::INT AS triple_plays,
        SUM(batting_outs)::INT AS batting_outs,
        SUM(balls_in_play)::INT AS balls_in_play,
        SUM(balls_batted)::INT AS balls_batted,
        SUM(trajectory_fly_ball)::INT AS trajectory_fly_ball,
        SUM(trajectory_ground_ball)::INT AS trajectory_ground_ball,
        SUM(trajectory_line_drive)::INT AS trajectory_line_drive,
        SUM(trajectory_pop_up)::INT AS trajectory_pop_up,
        SUM(trajectory_unknown)::INT AS trajectory_unknown,
        SUM(trajectory_known)::INT AS trajectory_known,
        SUM(trajectory_broad_air_ball)::INT AS trajectory_broad_air_ball,
        SUM(trajectory_broad_ground_ball)::INT AS trajectory_broad_ground_ball,
        SUM(trajectory_broad_unknown)::INT AS trajectory_broad_unknown,
        SUM(trajectory_broad_known)::INT AS trajectory_broad_known,
        SUM(bunts)::INT AS bunts,
        SUM(batted_distance_plate)::INT AS batted_distance_plate,
        SUM(batted_distance_infield)::INT AS batted_distance_infield,
        SUM(batted_distance_outfield)::INT AS batted_distance_outfield,
        SUM(batted_distance_unknown)::INT AS batted_distance_unknown,
        SUM(batted_distance_known)::INT AS batted_distance_known,
        SUM(fielded_by_battery)::INT AS fielded_by_battery,
        SUM(fielded_by_infielder)::INT AS fielded_by_infielder,
        SUM(fielded_by_outfielder)::INT AS fielded_by_outfielder,
        SUM(fielded_by_known)::INT AS fielded_by_known,
        SUM(fielded_by_unknown)::INT AS fielded_by_unknown,
        SUM(batted_angle_left)::INT AS batted_angle_left,
        SUM(batted_angle_right)::INT AS batted_angle_right,
        SUM(batted_angle_middle)::INT AS batted_angle_middle,
        SUM(batted_angle_unknown)::INT AS batted_angle_unknown,
        SUM(batted_angle_known)::INT AS batted_angle_known,
        SUM(batted_location_plate)::INT AS batted_location_plate,
        SUM(batted_location_right_infield)::INT AS batted_location_right_infield,
        SUM(batted_location_middle_infield)::INT AS batted_location_middle_infield,
        SUM(batted_location_left_infield)::INT AS batted_location_left_infield,
        SUM(batted_location_left_field)::INT AS batted_location_left_field,
        SUM(batted_location_center_field)::INT AS batted_location_center_field,
        SUM(batted_location_right_field)::INT AS batted_location_right_field,
        SUM(batted_location_unknown)::INT AS batted_location_unknown,
        SUM(batted_location_known)::INT AS batted_location_known,
        SUM(batted_balls_pulled)::INT AS batted_balls_pulled,
        SUM(batted_balls_opposite_field)::INT AS batted_balls_opposite_field,
        SUM(runs)::INT AS runs,
        SUM(times_reached_base)::INT AS times_reached_base,
        SUM(stolen_base_opportunities)::INT AS stolen_base_opportunities,
        SUM(stolen_base_opportunities_second)::INT AS stolen_base_opportunities_second,
        SUM(stolen_base_opportunities_third)::INT AS stolen_base_opportunities_third,
        SUM(stolen_base_opportunities_home)::INT AS stolen_base_opportunities_home,
        SUM(stolen_bases)::INT AS stolen_bases,
        SUM(stolen_bases_second)::INT AS stolen_bases_second,
        SUM(stolen_bases_third)::INT AS stolen_bases_third,
        SUM(stolen_bases_home)::INT AS stolen_bases_home,
        SUM(caught_stealing)::INT AS caught_stealing,
        SUM(caught_stealing_second)::INT AS caught_stealing_second,
        SUM(caught_stealing_third)::INT AS caught_stealing_third,
        SUM(caught_stealing_home)::INT AS caught_stealing_home,
        SUM(picked_off)::INT AS picked_off,
        SUM(picked_off_first)::INT AS picked_off_first,
        SUM(picked_off_second)::INT AS picked_off_second,
        SUM(picked_off_third)::INT AS picked_off_third,
        SUM(picked_off_caught_stealing)::INT AS picked_off_caught_stealing,
        SUM(outs_on_basepaths)::INT AS outs_on_basepaths,
        SUM(unforced_outs_on_basepaths)::INT AS unforced_outs_on_basepaths,
        SUM(outs_avoided_on_errors)::INT AS outs_avoided_on_errors,
        SUM(advances_on_wild_pitches)::INT AS advances_on_wild_pitches,
        SUM(advances_on_passed_balls)::INT AS advances_on_passed_balls,
        SUM(advances_on_balks)::INT AS advances_on_balks,
        SUM(advances_on_unspecified_plays)::INT AS advances_on_unspecified_plays,
        SUM(advances_on_defensive_indifference)::INT AS advances_on_defensive_indifference,
        SUM(advances_on_errors)::INT AS advances_on_errors,
        SUM(extra_base_chances)::INT AS extra_base_chances,
        SUM(extra_base_advance_attempts)::INT AS extra_base_advance_attempts,
        SUM(extra_bases_taken)::INT AS extra_bases_taken,
        SUM(bases_advanced)::INT AS bases_advanced,
        SUM(bases_advanced_on_balls_in_play)::INT AS bases_advanced_on_balls_in_play,
        SUM(surplus_bases_advanced_on_balls_in_play)::INT AS surplus_bases_advanced_on_balls_in_play,
        SUM(outs_on_extra_base_advance_attempts)::INT AS outs_on_extra_base_advance_attempts,
        SUM(pitches)::INT AS pitches,
        SUM(swings)::INT AS swings,
        SUM(swings_with_contact)::INT AS swings_with_contact,
        SUM(strikes)::INT AS strikes,
        SUM(strikes_called)::INT AS strikes_called,
        SUM(strikes_swinging)::INT AS strikes_swinging,
        SUM(strikes_foul)::INT AS strikes_foul,
        SUM(strikes_foul_tip)::INT AS strikes_foul_tip,
        SUM(strikes_in_play)::INT AS strikes_in_play,
        SUM(strikes_unknown)::INT AS strikes_unknown,
        SUM(balls)::INT AS balls,
        SUM(balls_called)::INT AS balls_called,
        SUM(balls_intentional)::INT AS balls_intentional,
        SUM(balls_automatic)::INT AS balls_automatic,
        SUM(unknown_pitches)::INT AS unknown_pitches,
        SUM(pitchouts)::INT AS pitchouts,
        SUM(pitcher_pickoff_attempts)::INT AS pitcher_pickoff_attempts,
        SUM(catcher_pickoff_attempts)::INT AS catcher_pickoff_attempts,
        SUM(pitches_blocked_by_catcher)::INT AS pitches_blocked_by_catcher,
        SUM(pitches_with_runners_going)::INT AS pitches_with_runners_going,
        SUM(passed_balls)::INT AS passed_balls,
        SUM(wild_pitches)::INT AS wild_pitches,
        SUM(balks)::INT AS balks,
        SUM(left_on_base)::INT AS left_on_base,
        SUM(left_on_base_with_two_outs)::INT AS left_on_base_with_two_outs,
        SUM(games_started)::INT AS games_started,
        SUM(innings_pitched)::INT AS innings_pitched,
        SUM(inherited_runners)::INT AS inherited_runners,
        SUM(bequeathed_runners)::INT AS bequeathed_runners,
        SUM(games_relieved)::INT AS games_relieved,
        SUM(games_finished)::INT AS games_finished,
        SUM(save_situations_entered)::INT AS save_situations_entered,
        SUM(holds)::INT AS holds,
        SUM(blown_saves)::INT AS blown_saves,
        SUM(saves_by_rule)::INT AS saves_by_rule,
        SUM(save_opportunities)::INT AS save_opportunities,
        SUM(wins)::INT AS wins,
        SUM(losses)::INT AS losses,
        SUM(saves)::INT AS saves,
        SUM(earned_runs)::INT AS earned_runs,
        SUM(complete_games)::INT AS complete_games,
        SUM(shutouts)::INT AS shutouts,
        SUM(quality_starts)::INT AS quality_starts,
        SUM(cheap_wins)::INT AS cheap_wins,
        SUM(tough_losses)::INT AS tough_losses,
        SUM(no_decisions)::INT AS no_decisions,
        SUM(no_hitters)::INT AS no_hitters,
        SUM(perfect_games)::INT AS perfect_games,
        
    FROM "timeball"."main_models"."stg_games" AS games
    INNER JOIN "timeball"."main_models"."player_game_pitching_stats" AS stats USING (game_id)
    GROUP BY 1, 2, 3, 4
),

reround_ip AS (
    SELECT * REPLACE (
        ROUND(outs_recorded / 3, 2) AS innings_pitched
    )
    FROM retrosheet
)

SELECT * FROM reround_ip
UNION ALL BY NAME
SELECT * FROM databank